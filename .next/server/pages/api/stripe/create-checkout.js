"use strict";(()=>{var e={};e.id=9203,e.ids=[9203],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},2666:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var s=r(1802),n=r(7153),i=r(6249),c=r(2032),o=e([c]);c=(o.then?(await o)():o)[0];let u=(0,i.l)(c,"default"),l=(0,i.l)(c,"config"),d=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/stripe/create-checkout",pathname:"/api/stripe/create-checkout",bundlePath:"",filename:""},userland:c});a()}catch(e){a(e)}})},8623:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{_R:()=>createCheckout});var s=r(6090),n=e([s]);s=(n.then?(await n)():n)[0];let createCheckout=async({user:e,clientReferenceID:t,successUrl:r,cancelUrl:a,priceId:n,couponId:i})=>{let c=new s.default(process.env.STRIPE_SECRET_KEY),o={};e?.customerId?o.customer=e.customerId:(o.customer_creation="always",e?.email&&(o.customer_email=e.email));let u=await c.checkout.sessions.create({mode:"payment",...o,allow_promotion_codes:!0,invoice_creation:{enabled:!0},tax_id_collection:{enabled:!0},client_reference_id:t,payment_intent_data:{setup_future_usage:"on_session"},line_items:[{price:n,quantity:1}],discounts:i?[{coupon:i}]:[],success_url:r,cancel_url:a});return u.url};a()}catch(e){a(e)}})},2032:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>handler});var s=r(4768),n=r(8623),i=e([n]);async function handler(e,t){let{data:{session:r},error:a}=await s.O.auth.getSession();if(a||!r)return t.status(401).json({error:"Not authenticated"});let{method:i,body:c}=e,o=r.user.id;if("POST"===i){if(!c.priceId)return t.status(404).send({error:"Need a Price ID for Stripe"});if(!c.successUrl||!c.cancelUrl)return t.status(404).send({error:"Need valid success/failure URL to return to"});try{let{data:e,error:r}=await s.O.from("profiles").select("*").eq("id",o).single();if(r)return t.status(404).json({error:"User doesn't exist"});let{coupon:a,successUrl:i,cancelUrl:u}=c,l=await (0,n._R)({successUrl:i,cancelUrl:u,clientReferenceID:o,priceId:c.priceId,coupon:a});return t.status(200).json({url:l})}catch(e){return console.error(e),t.status(500).json({error:e?.message})}}t.status(404).json({error:"Unknown request type"})}n=(i.then?(await i)():i)[0],a()}catch(e){a(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,4768],()=>__webpack_exec__(2666));module.exports=r})();