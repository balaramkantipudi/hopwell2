"use strict";(()=>{var e={};e.id=9203,e.ids=[9203],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6090:e=>{e.exports=import("stripe")},2666:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var s=r(1802),i=r(7153),c=r(6249),n=r(2032),o=e([n]);n=(o.then?(await o)():o)[0];let u=(0,c.l)(n,"default"),l=(0,c.l)(n,"config"),d=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/stripe/create-checkout",pathname:"/api/stripe/create-checkout",bundlePath:"",filename:""},userland:n});a()}catch(e){a(e)}})},8623:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{_R:()=>createCheckout});var s=r(6090),i=e([s]);s=(i.then?(await i)():i)[0];let createCheckout=async({user:e,clientReferenceID:t,successUrl:r,cancelUrl:a,priceId:i,couponId:c})=>{let n=new s.default(process.env.STRIPE_SECRET_KEY),o={};e?.customerId?o.customer=e.customerId:(o.customer_creation="always",e?.email&&(o.customer_email=e.email));let u=await n.checkout.sessions.create({mode:"payment",...o,allow_promotion_codes:!0,invoice_creation:{enabled:!0},tax_id_collection:{enabled:!0},client_reference_id:t,payment_intent_data:{setup_future_usage:"on_session"},line_items:[{price:i,quantity:1}],discounts:c?[{coupon:c}]:[],success_url:r,cancel_url:a});return u.url};a()}catch(e){a(e)}})},6548:(e,t,r)=>{r.d(t,{O:()=>s});let a=require("@supabase/supabase-js"),s=(0,a.createClient)("https://qlcenpzwdvvtcnblixyp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFsY2VucHp3ZHZ2dGNuYmxpeHlwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYzOTY4MTMsImV4cCI6MjA2MTk3MjgxM30.B332OjGROnVxsSKra9T_Uh6fQvVdhOH21z7731pc1Kk")},2032:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>handler});var s=r(6548),i=r(8623),c=e([i]);async function handler(e,t){let{data:{session:r},error:a}=await s.O.auth.getSession();if(a||!r)return t.status(401).json({error:"Not authenticated"});let{method:c,body:n}=e,o=r.user.id;if("POST"===c){if(!n.priceId)return t.status(404).send({error:"Need a Price ID for Stripe"});if(!n.successUrl||!n.cancelUrl)return t.status(404).send({error:"Need valid success/failure URL to return to"});try{let{data:e,error:r}=await s.O.from("profiles").select("*").eq("id",o).single();if(r)return t.status(404).json({error:"User doesn't exist"});let{coupon:a,successUrl:c,cancelUrl:u}=n,l=await (0,i._R)({successUrl:c,cancelUrl:u,clientReferenceID:o,priceId:n.priceId,coupon:a});return t.status(200).json({url:l})}catch(e){return console.error(e),t.status(500).json({error:e?.message})}}t.status(404).json({error:"Unknown request type"})}i=(c.then?(await c)():c)[0],a()}catch(e){a(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222],()=>__webpack_exec__(2666));module.exports=r})();